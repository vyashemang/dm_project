<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Rollback And Cache</title>
    <link rel="stylesheet" type="text/css" href="../../../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Rollback And Cache</h1><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script><p><br></p><p>Suppose we have <a href="car.html" class="wikiLink">Car</a>, <a href="pilot.html" class="wikiLink">Pilot</a> and <a href="id.html" class="wikiLink">Id</a>
classes stored in the database. Car class is activatable, others are not. We
will modify the car and rollback the transaction:</p>

<span name="cs_wiki_filter" csw_filters="java">

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TPRollback.java: <span class="fscMemberName">modifyAndRollback</span></span></div><div class="fscCode"><pre ID="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> modifyAndRollback() </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_40_587_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> database(configureTP());
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (container </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">) </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_122_584_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Open_Text').style.display='inline';"/>      </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_131_544_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> create a car</span><span style="color: #008000;">
</span><span style="color: #008080;">06</span><span style="color: #008000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">        Car car </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Car) container.queryByExample(</span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Car(</span><span style="color: #0000FF;">null</span><span style="color: #000000;">, </span><span style="color: #0000FF;">null</span><span style="color: #000000;">))
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            .get(</span><span style="color: #000000;">0</span><span style="color: #000000;">);
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Initial car: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> car </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(car) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        car.setModel(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Ferrari</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        car.setPilot(</span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Michael Schumacher</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #000000;">123</span><span style="color: #000000;">));
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        container.rollback();
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Car after rollback: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> car </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(car) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Open_Text').style.display='inline';"/>      }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyAndRollback_256_70_553_580_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        closeDatabase();
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>      }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>

</span>





<p>If the transaction was going on normally (commit), we would
have had the car modified in the database as it is supported by Transparent
Persistence. However, as the transaction was rolled back - no modifications
should be done to the database. The result that is printed to the screen is
taken from the reference cache, so it will show modified objects. That is
confusing and should be fixed:</p>

<span name="cs_wiki_filter" csw_filters="java">

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TPRollback.java: <span class="fscMemberName">modifyRollbackAndCheck</span></span></div><div class="fscCode"><pre ID="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> modifyRollbackAndCheck() </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_45_875_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> database(configureTP());
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (container </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">) </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_127_872_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Open_Text').style.display='inline';"/>      </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_136_832_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> create a car</span><span style="color: #008000;">
</span><span style="color: #008080;">06</span><span style="color: #008000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">        Car car </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Car) container.queryByExample(</span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Car(</span><span style="color: #0000FF;">null</span><span style="color: #000000;">, </span><span style="color: #0000FF;">null</span><span style="color: #000000;">))
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            .get(</span><span style="color: #000000;">0</span><span style="color: #000000;">);
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        Pilot pilot </span><span style="color: #000000;">=</span><span style="color: #000000;"> car.getPilot();
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Initial car: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> car </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(car) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Initial pilot: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> pilot </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(pilot) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        car.setModel(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Ferrari</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        car.changePilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Michael Schumacher</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #000000;">123</span><span style="color: #000000;">);
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        container.rollback();
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        container.deactivate(car, Integer.MAX_VALUE);
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Car after rollback: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> car </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(car) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Pilot after rollback: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> pilot </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #000000;">+</span><span style="color: #000000;"> container.ext().getID(pilot) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Open_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Closed_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Closed_Text').style.display='inline';"/><img id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Closed_Text').style.display='none'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Open_Image').style.display='inline'; document.getElementById('....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Open_Text').style.display='inline';"/>      }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="....RollbackJava.ZipsTPRollback.Java_TPRollback.Java_ModifyRollbackAndCheck_808_75_841_868_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">22</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        closeDatabase();
</span><span style="color: #008080;">23</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>      }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">24</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">25</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>

</span>





<p>Here we've added a <code>deactivate</code> call for the car
object. This call is used to clear the reference cache and its action is
reversed to <code>activate</code>. </p>

<p>We've used Integer.MAX_VALUE/Int32.MaxValue to deactivate
car fields to the maximum possible depth. Thus we can be sure that all the car
fields will be re-read from the database again (no outdated values from the
reference cache), but the trade-off is that all child objects will be
deactivated and read from the database too. You can see it on Pilot object.
This behaviour is preserved for both activatable and non-activatable objects.</p></div>
    </div>
    <div id="footer">
					This revision (1) was last Modified 2008-03-02T09:33:06 by Tetyana.
				</div>
  </body>
</html>