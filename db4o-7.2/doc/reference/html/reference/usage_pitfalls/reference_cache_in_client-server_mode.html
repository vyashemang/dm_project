<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Reference Cache In Client-Server Mode</title>
    <link rel="stylesheet" type="text/css" href="../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Reference Cache In Client-Server Mode</h1><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script>Db4o uses object <a href="../basic_concepts/object_identity/weak_references.html" class="wikiLink">reference
cache</a> for easy access to persistent objects during one transaction. In
client/server mode each client has its own reference cache, which helps to
achieve good performance. However it gets complicated, when different clients
work on the same object, as this object's cached value is used on each side. It
means, that even when the operations go serially, the object's value won't be
updated serially unless it is refreshed before each update.

<p>The following example demonstrates this behaviour.</p>

<span name="cs_wiki_filter" csw_filters="java">

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">InconsistentGraphExample.java: <span class="fscMemberName">main</span></span></div><div class="fscCode"><pre ID="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">1</span><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Open_Text').style.display='inline';"/><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> main(String[] args) </span><span style="color: #0000FF;">throws</span><span style="color: #000000;"> IOException </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Main_647_69_58_102_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">2</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> InconsistentGraphExample().run();
</span><span style="color: #008080;">3</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">InconsistentGraphExample.java: <span class="fscMemberName">run</span></span></div><div class="fscCode"><pre ID="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Open_Text').style.display='inline';"/><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> run() </span><span style="color: #0000FF;">throws</span><span style="color: #000000;"> IOException, DatabaseFileLockedException </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_66_2038_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> File(DB4O_FILE_NAME).delete();
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectServer server </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.openServer(DB4O_FILE_NAME, PORT);
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_174_1950_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      server.grantAccess(USER, PASSWORD);
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      ObjectContainer client1 </span><span style="color: #000000;">=</span><span style="color: #000000;"> server.openClient();
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      ObjectContainer client2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> server.openClient();
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Open_Text').style.display='inline';"/>      </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (client1 </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> client2 </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">) </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_360_1946_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Open_Text').style.display='inline';"/>        </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_370_1815_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #008000;">//</span><span style="color: #008000;"> wait for the operations to finish</span><span style="color: #008000;">
</span><span style="color: #008080;">13</span><span style="color: #008000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">          waitForCompletion();
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #008000;">//</span><span style="color: #008000;"> save pilot with client1</span><span style="color: #008000;">
</span><span style="color: #008080;">16</span><span style="color: #008000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">          Car client1Car </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Car(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Ferrari</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #000000;">2006</span><span style="color: #000000;">, </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>              </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Schumacher</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">));
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1.set(client1Car);
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1.commit();
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Client1 version initially: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> client1Car);
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          waitForCompletion();
</span><span style="color: #008080;">22</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">23</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #008000;">//</span><span style="color: #008000;"> retrieve the same pilot with client2</span><span style="color: #008000;">
</span><span style="color: #008080;">24</span><span style="color: #008000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">          Car client2Car </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Car) client2.query(Car.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">).next();
</span><span style="color: #008080;">25</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Client2 version initially: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> client2Car);
</span><span style="color: #008080;">26</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">27</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #008000;">//</span><span style="color: #008000;"> delete the pilot with client1</span><span style="color: #008000;">
</span><span style="color: #008080;">28</span><span style="color: #008000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">          Pilot client1Pilot </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Pilot)client1.query(Pilot.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">).next();
</span><span style="color: #008080;">29</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1.delete(client1Pilot);
</span><span style="color: #008080;">30</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #008000;">//</span><span style="color: #008000;"> modify the car, add and link a new pilot with client1</span><span style="color: #008000;">
</span><span style="color: #008080;">31</span><span style="color: #008000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">          client1Car.setModel(</span><span style="color: #000000;">2007</span><span style="color: #000000;">);
</span><span style="color: #008080;">32</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1Car.setPilot(</span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Hakkinnen</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">));
</span><span style="color: #008080;">33</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1.set(client1Car);
</span><span style="color: #008080;">34</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1.commit();
</span><span style="color: #008080;">35</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">36</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          waitForCompletion();
</span><span style="color: #008080;">37</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client1Car </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Car) client1.query(Car.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">).next();
</span><span style="color: #008080;">38</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Client1 version after update: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> client1Car);
</span><span style="color: #008080;">39</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">40</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">41</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println();
</span><span style="color: #008080;">42</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">client2Car still holds the old object graph in its reference cache</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">); 
</span><span style="color: #008080;">43</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          client2Car </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Car) client2.query(Car.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">).next();
</span><span style="color: #008080;">44</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Client2 version after update: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> client2Car);
</span><span style="color: #008080;">45</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          ObjectSet result </span><span style="color: #000000;">=</span><span style="color: #000000;"> client2.query(Pilot.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">46</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Though the new Pilot is retrieved by a new query: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">47</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          listResult(result);
</span><span style="color: #008080;">48</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">49</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          waitForCompletion();
</span><span style="color: #008080;">50</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Open_Text').style.display='inline';"/>        }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">catch</span><span style="color: #000000;"> (Exception ex) </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1837_1871_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">51</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          ex.printStackTrace();
</span><span style="color: #008080;">52</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Open_Text').style.display='inline';"/>        }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1880_1941_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">53</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          closeClient(client1);
</span><span style="color: #008080;">54</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          closeClient(client2);
</span><span style="color: #008080;">55</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>        }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">56</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>      }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">57</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">catch</span><span style="color: #000000;"> (Exception ex) </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_1972_2002_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">58</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      ex.printStackTrace();
</span><span style="color: #008080;">59</span><span style="color: #000000;"><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceUsage_PitfallsReference_Cache_In_Client-Server_ModeInconsistentJava.ZipsInconsistentGraphExample.Java_InconsistentGraphExample.Java_Run_720_68_2011_2035_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">60</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      server.close();
</span><span style="color: #008080;">61</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">62</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>

</span>





<p>In order to make the objects consistent on each client you
must refresh them from the server when they get updated. This can be done by
using <a href="../implementation_strategies/callbacks/commit-time_callbacks/committed_event_example.html" class="wikiLink">Committed
Callbacks</a>.</p></div>
    </div>
    <div id="footer">
					This revision (1) was last Modified 2007-09-15T19:10:18 by Tetyana.
				</div>
  </body>
</html>