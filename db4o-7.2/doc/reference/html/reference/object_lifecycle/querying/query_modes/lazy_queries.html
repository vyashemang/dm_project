<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Lazy Queries</title>
    <link rel="stylesheet" type="text/css" href="../../../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Lazy Queries</h1><div id="TOC"><div id="TOCinner"><span class="TOCtitle">Contents</span><div class="TOCcontents"><ul><li><a href ="#Pros and Cons for Lazy Queries">Pros and Cons for Lazy Queries</a></li></ul></li></ul></div></div></div><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script> 

<P>In Lazy Querying mode objects are not evaluated at all, instead of this an iterator is created against the best index found. Further query processing (including all index processing) will happen when the user application iterates through the resulting <CODE>ObjectSet</CODE>. This allows you to get the first query results almost immediately.</P>
<span name="cs_wiki_filter" csw_filters="java">
<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">QueryModesExample.java: <span class="fscMemberName">testLazyQueries</span></span></div><div class="fscCode"><pre ID="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> testLazyQueries() </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_38_729_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    System.out
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        .println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Testing query performance on 10000 pilot objects in Lazy mode</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    fillUpDB(</span><span style="color: #000000;">10000</span><span style="color: #000000;">);
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    Configuration configuration </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.newConfiguration();
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    configuration.queries().evaluationMode(QueryEvaluationMode.LAZY);
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.openFile(configuration, DB4O_FILE_NAME);
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_358_690_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      QueryStats stats </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> QueryStats();
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      stats.connect(container);
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Query query </span><span style="color: #000000;">=</span><span style="color: #000000;"> container.query();
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query.constrain(Pilot.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query.descend(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">points</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">).constrain(</span><span style="color: #000000;">99</span><span style="color: #000000;">).greater();
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query.execute();
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      </span><span style="color: #0000FF;">long</span><span style="color: #000000;"> executionTime </span><span style="color: #000000;">=</span><span style="color: #000000;"> stats.executionTime();
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Query execution time: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #000000;">+</span><span style="color: #000000;"> executionTime);
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyQueries_405_70_699_726_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.close();
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>
</span>


<P>In addition to the very fast execution this method also ensures very small memory consumption, as lazy queries do not need an intermediate representation as a set of IDs in memory. With this approach a lazy query ObjectSet does not have to cache a single object or ID. The memory consumption for a query is practically zero, no matter how large the resultset is going to be.</P>
<P>There are some interesting effects appearing due to the fact that the objects are getting evaluated only on a request. It means that all the committed modifications from the other transactions and uncommitted modifications from the same transaction will be taken into account when delivering the result objects:</P>
<span name="cs_wiki_filter" csw_filters="java">
<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">QueryModesExample.java: <span class="fscMemberName">testLazyConcurrent</span></span></div><div class="fscCode"><pre ID="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> testLazyConcurrent() </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_41_1092_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    System.out
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        .println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Testing lazy mode with concurrent modifications</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    fillUpDB(</span><span style="color: #000000;">10</span><span style="color: #000000;">);
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    Configuration configuration </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.newConfiguration();
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    configuration.queries().evaluationMode(QueryEvaluationMode.LAZY);
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.openFile(configuration, DB4O_FILE_NAME);
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_344_1053_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Query query1 </span><span style="color: #000000;">=</span><span style="color: #000000;"> container.query();
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query1.constrain(Pilot.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query1.descend(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">points</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">).constrain(</span><span style="color: #000000;">5</span><span style="color: #000000;">).smaller();
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      ObjectSet result1 </span><span style="color: #000000;">=</span><span style="color: #000000;"> query1.execute();
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Query query2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> container.query();
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query2.constrain(Pilot.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      query2.descend(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">points</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">).constrain(</span><span style="color: #000000;">1</span><span style="color: #000000;">);
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      ObjectSet result2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> query2.execute();
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Pilot pilotToDelete </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Pilot) result2.get(</span><span style="color: #000000;">0</span><span style="color: #000000;">);
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Pilot to be deleted: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          </span><span style="color: #000000;">+</span><span style="color: #000000;"> pilotToDelete);
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.delete(pilotToDelete);
</span><span style="color: #008080;">22</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Pilot pilot </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Tester</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #000000;">2</span><span style="color: #000000;">);
</span><span style="color: #008080;">23</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Pilot to be added: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> pilot);
</span><span style="color: #008080;">24</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.set(pilot);
</span><span style="color: #008080;">25</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">26</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out
</span><span style="color: #008080;">27</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          .println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Query result after changing from the same transaction</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">28</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      listResult(result1);
</span><span style="color: #008080;">29</span><span style="color: #000000;"><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Open_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Open_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Closed_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Closed_Text').style.display='inline';"/><img id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Closed_Image" src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Closed_Text').style.display='none'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Open_Image').style.display='inline'; document.getElementById('ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="ResourcesReferenceObject_LifecycleQueryingQuery_ModesquerymodeJava.ZipsQueryModesExample.Java_QueryModesExample.Java_TestLazyConcurrent_1242_73_1062_1089_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">30</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.close();
</span><span style="color: #008080;">31</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">32</span><span style="color: #000000;"><img src="../../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>
</span>


<a name="Pros and Cons for Lazy Queries"></a><H2>Pros and Cons for Lazy Queries</H2>
<P>Pros:</P>
<UL>
<LI>The call to <CODE>Query.execute()</CODE> will return very fast. First results can be made available to the application before the query is fully processed.</LI>
<LI>A query will consume hardly any memory at all because no intermediate ID representation is ever created.</LI></UL>
<P>Cons:</P>
<UL>
<LI>Lazy queries check candidates when iterating through the resulting <CODE>ObjectSet</CODE>. In doing so the query processor takes changes into account that may have happened since the Query.execute() call: committed changes from other transactions, <B>and uncommitted changes from the calling transaction</B>. There is a wide range of possible side effects:</LI>
<UL>
<LI>The underlying index may have changed. </LI>
<LI>Objects themselves may have changed in the meanwhile. </LI>
<LI>There even is a chance of creating an endless loop. If the caller iterates through the <CODE>ObjectSet</CODE> and changes each object in a way that it is placed at the end of the index, the same objects can be revisited over and over. </LI></UL><B>In lazy mode it can make sense to work in a way one would work with collections to avoid concurrent modification exceptions.</B> For instance one could iterate through the <CODE>ObjectSet</CODE> first and store all the objects to a temporary collection representation before changing objects and storing them back to db4o. 
<LI>Some method calls against a lazy <CODE>ObjectSet</CODE> will require the query processor to create a snapshot or to evaluate the query fully. An example of such a call is <CODE>ObjectSet.size()</CODE>.</LI></UL>
<P>Lazy mode can be an excellent choice for single transaction read use, to keep memory consumption as low as possible.</P></div>
    </div>
    <div id="footer">
					This revision (7) was last Modified 2007-11-21T17:18:40 by Eric Falsken.
				</div>
  </body>
</html>